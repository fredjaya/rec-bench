# https://public.confluence.arizona.edu/display/UAHPC/Singularity+Tutorials#SingularityTutorials-CentOSwithTensorflowExample
# https://tecadmin.net/install-python-3-7-on-centos/
# https://linuxize.com/post/how-to-install-pip-on-centos-7/#2-install-pip

BootStrap: yum
OSVersion: 7
MirrorURL: http://mirror.centos.org/centos-%{OSVERSION}/%{OSVERSION}/os/$basearch/
Include: yum wget

%post
    # commands to be executed inside container during bootstrap
    # add python and install some packages
    yum -y install gcc openssl-devel bzip2-devel libffi-devel epel-release tar.x86_64
    cd /usr/src
    wget https://www.python.org/ftp/python/3.7.3/Python-3.7.3.tgz
    tar xzf Python-3.7.3.tgz
    cd Python-3.7.3
    ./configure --enable-optimizations
    make altinstall
    rm /usr/src/Python-3.7.3.tgz
    yum -y install python-pip
     # install dependencies
    pip install --upgrade pip
    pip install matplotlib
     # create bind points for storage.
     mkdir /extra
     mkdir /xdisk
     exit 0
 %runscript
   # commands to be executed when the container runs
  # echo "Arguments received: $*"
   #exec /usr/bin/python3 "$@"
 %test
   # commands to be executed within container at close of bootstrap process
   python3.7 -V
   pip -V
